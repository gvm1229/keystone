---
/**
 * Blog 목록 페이지 - Keystatic posts 콜렉션
 */
import BaseLayout from "@/layouts/BaseLayout.astro";
import { getCollection, type CollectionEntry } from "astro:content";

let posts: CollectionEntry<"posts">[] = [];
try {
    posts = await getCollection("posts");
} catch {
    // 콜렉션이 없을 수 있음
}
const sortedPosts = [...posts].sort(
    (a, b) =>
        new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime()
);
---

<BaseLayout title="Blog - Keystone" description="기술 블로그">
    <h1 class="text-3xl font-bold mb-6 text-(--color-foreground)">Blog</h1>
    <p class="text-(--color-muted) mb-8">
        Keystatic으로 관리하는 블로그 포스트입니다.
    </p>

    {
        sortedPosts.length === 0 ? (
            <p class="text-(--color-muted)">
                아직 작성된 포스트가 없습니다. 개발 서버에서 /keystatic 으로
                접속해 포스트를 추가해 보세요.
            </p>
        ) : (
            <ul class="space-y-4">
                {sortedPosts.map((post) => (
                    <li>
                        <a
                            href={`/blog/${post.slug}`}
                            class="block p-4 rounded-lg border border-(--color-border) bg-(--color-surface-subtle) hover:opacity-90 transition-opacity"
                        >
                            <h2 class="font-semibold text-lg text-(--color-foreground)">
                                {post.data.title}
                            </h2>
                            {post.data.description && (
                                <p class="text-sm text-(--color-muted) mt-1">
                                    {post.data.description}
                                </p>
                            )}
                            <time
                                class="text-xs text-(--color-muted) mt-2 block"
                                datetime={post.data.pubDate.toISOString()}
                            >
                                {post.data.pubDate.toLocaleDateString("ko-KR")}
                            </time>
                        </a>
                    </li>
                ))}
            </ul>
        )
    }
</BaseLayout>
