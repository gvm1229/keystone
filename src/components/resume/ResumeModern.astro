---
/**
 * Modern 레이아웃: 한 컬럼, 섹션별 구분 명확
 */
import type { Resume } from "@/types/resume";

interface Props {
    resume: Resume;
}

const { resume } = Astro.props;
const basics = resume.basics ?? {};

// JSON 순서 유지: basics 제외한 섹션들을 순서대로
const sections = Object.entries(resume).filter(
    ([key]) => key !== "basics" && key !== "$schema"
);

// 날짜 범위 포맷팅 헬퍼 함수
const formatDateRange = (startDate?: string, endDate?: string): string => {
    return `${startDate || ""} ~ ${endDate || "Present"}`;
};
---

<div class="resume-modern">
    <!-- 헤더: 기본 정보 -->
    <header class="resume-modern-header">
        {basics.name ? <h1 class="resume-name">{basics.name}</h1> : null}
        {basics.label ? <p class="resume-label">{basics.label}</p> : null}
        <div class="resume-modern-contact">
            {
                basics.email ? (
                    <a
                        href={`mailto:${basics.email}`}
                        class="resume-contact-link"
                    >
                        {basics.email}
                    </a>
                ) : null
            }
            {
                basics.phone ? (
                    <span class="resume-contact-link">{basics.phone}</span>
                ) : null
            }
            {
                basics.url ? (
                    <a
                        href={basics.url}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="resume-contact-link"
                    >
                        {basics.url}
                    </a>
                ) : null
            }
            {
                basics.location
                    ? [
                          basics.location.city,
                          basics.location.region,
                          basics.location.countryCode,
                      ]
                          .filter(Boolean)
                          .map((location) => (
                              <span class="resume-contact-link">
                                  {location}
                              </span>
                          ))
                    : null
            }
        </div>
        {
            basics.profiles && basics.profiles.length > 0 ? (
                <div class="resume-modern-profiles">
                    {basics.profiles.map((profile) => (
                        <a
                            href={profile.url}
                            target="_blank"
                            rel="noopener noreferrer"
                            class="resume-profile-link"
                        >
                            {profile.network}
                        </a>
                    ))}
                </div>
            ) : null
        }
        {basics.summary ? <p class="resume-summary">{basics.summary}</p> : null}
    </header>

    <!-- 메인 콘텐츠: 섹션별 렌더링 -->
    <main class="resume-modern-main">
        {
            sections.map(([sectionKey, sectionValue]) => {
                // 빈 섹션은 렌더링하지 않음
                if (
                    !sectionValue ||
                    (Array.isArray(sectionValue) && sectionValue.length === 0)
                )
                    return null;

                // Skills 섹션: 그리드 레이아웃으로 표시
                if (sectionKey === "skills" && Array.isArray(sectionValue)) {
                    return (
                        <section class="resume-section">
                            <h2 class="resume-section-title">Skills</h2>
                            <div class="resume-skills-grid">
                                {sectionValue.map((skill) => (
                                    <div class="resume-skill-card">
                                        {skill.name ? (
                                            <div class="resume-skill-name">
                                                {skill.name}
                                            </div>
                                        ) : null}
                                        {skill.level ? (
                                            <div class="resume-skill-level">
                                                {skill.level}
                                            </div>
                                        ) : null}
                                        {skill.keywords &&
                                        skill.keywords.length > 0 ? (
                                            <div class="resume-skill-keywords">
                                                {skill.keywords.map(
                                                    (keyword: string) => (
                                                        <span class="resume-skill-tag">
                                                            {keyword}
                                                        </span>
                                                    )
                                                )}
                                            </div>
                                        ) : null}
                                    </div>
                                ))}
                            </div>
                        </section>
                    );
                }

                // Work (경력) 섹션: 타임라인 레이아웃으로 표시
                if (sectionKey === "work" && Array.isArray(sectionValue)) {
                    return (
                        <section class="resume-section">
                            <h2 class="resume-section-title">Experience</h2>
                            <div class="resume-timeline">
                                {sectionValue.map((workItem) => (
                                    <div class="resume-timeline-item">
                                        <div class="resume-timeline-marker" />
                                        <div class="resume-timeline-content">
                                            <div class="resume-timeline-header">
                                                {workItem.position ? (
                                                    <h3 class="resume-timeline-title">
                                                        {workItem.position}
                                                    </h3>
                                                ) : null}
                                                {workItem.name ? (
                                                    <div class="resume-timeline-org">
                                                        {workItem.url ? (
                                                            <a
                                                                href={
                                                                    workItem.url
                                                                }
                                                                target="_blank"
                                                                rel="noopener noreferrer"
                                                            >
                                                                {workItem.name}
                                                            </a>
                                                        ) : (
                                                            workItem.name
                                                        )}
                                                    </div>
                                                ) : null}
                                                {(workItem.startDate ||
                                                    workItem.endDate) && (
                                                    <div class="resume-timeline-date">
                                                        {formatDateRange(
                                                            workItem.startDate,
                                                            workItem.endDate
                                                        )}
                                                    </div>
                                                )}
                                            </div>
                                            {workItem.summary ? (
                                                <p class="resume-timeline-summary">
                                                    {workItem.summary}
                                                </p>
                                            ) : null}
                                            {workItem.highlights &&
                                            workItem.highlights.length > 0 ? (
                                                <ul class="resume-timeline-highlights">
                                                    {workItem.highlights.map(
                                                        (highlight: string) => (
                                                            <li>{highlight}</li>
                                                        )
                                                    )}
                                                </ul>
                                            ) : null}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </section>
                    );
                }

                // Education (학력) 섹션: 그리드 레이아웃으로 표시
                if (sectionKey === "education" && Array.isArray(sectionValue)) {
                    return (
                        <section class="resume-section">
                            <h2 class="resume-section-title">Education</h2>
                            <div class="resume-education-grid">
                                {sectionValue.map((education) => (
                                    <div class="resume-education-card">
                                        {education.institution ? (
                                            <h3 class="resume-education-institution">
                                                {education.url ? (
                                                    <a
                                                        href={education.url}
                                                        target="_blank"
                                                        rel="noopener noreferrer"
                                                    >
                                                        {education.institution}
                                                    </a>
                                                ) : (
                                                    education.institution
                                                )}
                                            </h3>
                                        ) : null}
                                        {(education.studyType ||
                                            education.area) && (
                                            <div class="resume-education-degree">
                                                {`${education.studyType || ""} ${education.area ? " " + education.area : ""}`}
                                            </div>
                                        )}
                                        {(education.startDate ||
                                            education.endDate) && (
                                            <div class="resume-education-dates">
                                                {formatDateRange(
                                                    education.startDate,
                                                    education.endDate
                                                )}
                                            </div>
                                        )}
                                        {education.score && (
                                            <div class="resume-education-score">
                                                GPA: {education.score}
                                            </div>
                                        )}
                                        {education.courses &&
                                        education.courses.length > 0 ? (
                                            <div class="resume-education-courses">
                                                {education.courses.map(
                                                    (course: string) => (
                                                        <span class="resume-course-tag">
                                                            {course}
                                                        </span>
                                                    )
                                                )}
                                            </div>
                                        ) : null}
                                    </div>
                                ))}
                            </div>
                        </section>
                    );
                }

                // Projects (프로젝트) 섹션: 그리드 레이아웃으로 표시
                if (sectionKey === "projects" && Array.isArray(sectionValue)) {
                    return (
                        <section class="resume-section">
                            <h2 class="resume-section-title">Projects</h2>
                            <div class="resume-projects-grid">
                                {sectionValue.map((project) => (
                                    <div class="resume-project-card">
                                        {project.name ? (
                                            <h3 class="resume-project-name">
                                                {project.url ? (
                                                    <a
                                                        href={project.url}
                                                        target="_blank"
                                                        rel="noopener noreferrer"
                                                    >
                                                        {project.name}
                                                    </a>
                                                ) : (
                                                    project.name
                                                )}
                                            </h3>
                                        ) : null}
                                        {(project.startDate ||
                                            project.endDate) && (
                                            <div class="resume-project-dates">
                                                {formatDateRange(
                                                    project.startDate,
                                                    project.endDate
                                                )}
                                            </div>
                                        )}
                                        {project.description ? (
                                            <p class="resume-project-description">
                                                {project.description}
                                            </p>
                                        ) : null}
                                        {project.highlights &&
                                        project.highlights.length > 0 ? (
                                            <ul class="resume-project-highlights">
                                                {project.highlights.map(
                                                    (highlight: string) => (
                                                        <li>{highlight}</li>
                                                    )
                                                )}
                                            </ul>
                                        ) : null}
                                    </div>
                                ))}
                            </div>
                        </section>
                    );
                }

                // 기타 섹션 (volunteer, awards, certificates, publications, languages, interests, references)
                if (Array.isArray(sectionValue) && sectionValue.length > 0) {
                    const sectionTitleMap: { [key: string]: string } = {
                        volunteer: "Volunteer",
                        awards: "Awards",
                        certificates: "Certificates",
                        publications: "Publications",
                        languages: "Languages",
                        interests: "Interests",
                        references: "References",
                    };
                    const sectionTitle =
                        sectionTitleMap[sectionKey] ||
                        sectionKey.charAt(0).toUpperCase() +
                            sectionKey.slice(1);

                    return (
                        <section class="resume-section">
                            <h2 class="resume-section-title">{sectionTitle}</h2>
                            <div class="resume-generic-grid">
                                {sectionValue.map((genericItem: any) => (
                                    <div class="resume-generic-card">
                                        {genericItem.name ||
                                        genericItem.title ||
                                        genericItem.organization ||
                                        genericItem.language ? (
                                            <h3>
                                                {genericItem.name ||
                                                    genericItem.title ||
                                                    genericItem.organization ||
                                                    genericItem.language}
                                            </h3>
                                        ) : null}
                                        {genericItem.position ||
                                        genericItem.awarder ||
                                        genericItem.issuer ||
                                        genericItem.publisher ||
                                        genericItem.fluency ? (
                                            <div class="resume-generic-meta">
                                                {genericItem.position ||
                                                    genericItem.awarder ||
                                                    genericItem.issuer ||
                                                    genericItem.publisher ||
                                                    genericItem.fluency}
                                            </div>
                                        ) : null}
                                        {genericItem.startDate ||
                                        genericItem.date ||
                                        genericItem.releaseDate ? (
                                            <div class="resume-generic-date">
                                                {`${genericItem.startDate || genericItem.date || genericItem.releaseDate || ""}${
                                                    genericItem.endDate
                                                        ? " ~ " +
                                                          genericItem.endDate
                                                        : ""
                                                }`}
                                            </div>
                                        ) : null}
                                        {genericItem.summary ||
                                        genericItem.description ? (
                                            <p>
                                                {genericItem.summary ||
                                                    genericItem.description}
                                            </p>
                                        ) : null}
                                        {genericItem.highlights &&
                                        Array.isArray(genericItem.highlights) &&
                                        genericItem.highlights.length > 0 ? (
                                            <ul>
                                                {genericItem.highlights.map(
                                                    (highlight: string) => (
                                                        <li>{highlight}</li>
                                                    )
                                                )}
                                            </ul>
                                        ) : null}
                                        {genericItem.keywords &&
                                        Array.isArray(genericItem.keywords) &&
                                        genericItem.keywords.length > 0 ? (
                                            <div class="resume-keywords">
                                                {genericItem.keywords.map(
                                                    (keyword: string) => (
                                                        <span class="resume-keyword-tag">
                                                            {keyword}
                                                        </span>
                                                    )
                                                )}
                                            </div>
                                        ) : null}
                                        {genericItem.url ? (
                                            <a
                                                href={genericItem.url}
                                                target="_blank"
                                                rel="noopener noreferrer"
                                                class="resume-link"
                                            >
                                                {genericItem.url}
                                            </a>
                                        ) : null}
                                        {genericItem.reference ? (
                                            <p>{genericItem.reference}</p>
                                        ) : null}
                                    </div>
                                ))}
                            </div>
                        </section>
                    );
                }

                return null;
            })
        }
    </main>
</div>

<style>
    .resume-modern {
        max-width: 900px;
        margin: 0 auto;
        padding: 3rem 2rem;
        font-family:
            system-ui,
            -apple-system,
            sans-serif;
        color: var(--color-foreground);
        background: var(--color-surface);
    }

    .resume-modern-header {
        text-align: center;
        margin-bottom: 3rem;
        padding-bottom: 2rem;
        border-bottom: 3px solid var(--color-border);
    }

    .resume-name {
        font-size: 2.5rem;
        font-weight: 700;
        margin: 0 0 0.5rem 0;
        color: var(--color-foreground);
    }

    .resume-label {
        font-size: 1.1rem;
        color: var(--color-muted);
        margin: 0 0 1rem 0;
    }

    .resume-modern-contact {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 1rem;
        margin-bottom: 1rem;
        font-size: 0.9rem;
    }

    .resume-contact-link {
        color: var(--color-link);
        text-decoration: none;
    }

    .resume-contact-link:hover {
        text-decoration: underline;
    }

    .resume-modern-profiles {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 0.75rem;
        margin-bottom: 1rem;
    }

    .resume-profile-link {
        padding: 0.25rem 0.75rem;
        border: 1px solid var(--color-border);
        border-radius: 0.25rem;
        font-size: 0.85rem;
        color: var(--color-foreground);
        text-decoration: none;
        transition: background-color 0.2s;
    }

    .resume-profile-link:hover {
        background-color: var(--color-code-bg);
    }

    .resume-summary {
        font-size: 1rem;
        line-height: 1.7;
        margin: 1.5rem auto 0;
        max-width: 700px;
        color: var(--color-foreground);
    }

    .resume-modern-main {
        display: flex;
        flex-direction: column;
        gap: 2.5rem;
    }

    .resume-section {
        margin-bottom: 2rem;
    }

    .resume-section-title {
        font-size: 1.5rem;
        font-weight: 600;
        margin: 0 0 1.5rem 0;
        padding-bottom: 0.75rem;
        border-bottom: 2px solid var(--color-border);
        color: var(--color-foreground);
    }

    .resume-skills-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 1rem;
    }

    .resume-skill-card {
        padding: 1rem;
        border: 1px solid var(--color-border);
        border-radius: 0.5rem;
        background: var(--color-code-bg);
    }

    .resume-skill-name {
        font-weight: 600;
        margin-bottom: 0.5rem;
    }

    .resume-skill-level {
        font-size: 0.85rem;
        color: var(--color-muted);
        margin-bottom: 0.5rem;
    }

    .resume-skill-keywords {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
    }

    .resume-skill-tag {
        font-size: 0.8rem;
        padding: 0.2rem 0.5rem;
        background: var(--color-surface);
        border: 1px solid var(--color-border);
        border-radius: 0.25rem;
    }

    .resume-timeline {
        position: relative;
        padding-left: 2rem;
    }

    .resume-timeline::before {
        content: "";
        position: absolute;
        left: 0.5rem;
        top: 0;
        bottom: 0;
        width: 2px;
        background: var(--color-border);
    }

    .resume-timeline-item {
        position: relative;
        margin-bottom: 2rem;
    }

    .resume-timeline-marker {
        position: absolute;
        left: -1.5rem;
        top: 0.25rem;
        width: 0.75rem;
        height: 0.75rem;
        border-radius: 50%;
        background: var(--color-foreground);
        border: 2px solid var(--color-surface);
    }

    .resume-timeline-content {
        padding-left: 1rem;
    }

    .resume-timeline-title {
        font-size: 1.2rem;
        font-weight: 600;
        margin: 0 0 0.25rem 0;
    }

    .resume-timeline-org {
        font-size: 1rem;
        color: var(--color-muted);
        margin-bottom: 0.25rem;
    }

    .resume-timeline-org a {
        color: var(--color-link);
        text-decoration: none;
    }

    .resume-timeline-date {
        font-size: 0.875rem;
        color: var(--color-muted);
        margin-bottom: 0.5rem;
    }

    .resume-timeline-summary {
        font-size: 0.95rem;
        line-height: 1.6;
        margin: 0.5rem 0;
    }

    .resume-timeline-highlights {
        margin: 0.5rem 0;
        padding-left: 1.25rem;
        font-size: 0.9rem;
    }

    .resume-timeline-highlights li {
        margin-bottom: 0.25rem;
    }

    .resume-education-grid,
    .resume-projects-grid,
    .resume-generic-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 1.5rem;
    }

    .resume-education-card,
    .resume-project-card,
    .resume-generic-card {
        padding: 1.25rem;
        border: 1px solid var(--color-border);
        border-radius: 0.5rem;
        background: var(--color-code-bg);
    }

    .resume-education-institution,
    .resume-project-name {
        font-size: 1.1rem;
        font-weight: 600;
        margin: 0 0 0.5rem 0;
    }

    .resume-education-institution a,
    .resume-project-name a {
        color: var(--color-link);
        text-decoration: none;
    }

    .resume-education-degree {
        font-size: 0.95rem;
        color: var(--color-muted);
        margin-bottom: 0.5rem;
    }

    .resume-education-dates,
    .resume-project-dates,
    .resume-generic-date {
        font-size: 0.875rem;
        color: var(--color-muted);
        margin-bottom: 0.5rem;
    }

    .resume-education-score {
        font-size: 0.875rem;
        color: var(--color-muted);
        margin-bottom: 0.5rem;
    }

    .resume-education-courses {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: 0.5rem;
    }

    .resume-course-tag {
        font-size: 0.8rem;
        padding: 0.2rem 0.5rem;
        background: var(--color-surface);
        border: 1px solid var(--color-border);
        border-radius: 0.25rem;
    }

    .resume-project-description {
        font-size: 0.9rem;
        line-height: 1.6;
        margin: 0.5rem 0;
    }

    .resume-project-highlights {
        margin: 0.5rem 0;
        padding-left: 1.25rem;
        font-size: 0.9rem;
    }

    .resume-project-highlights li {
        margin-bottom: 0.25rem;
    }

    .resume-generic-meta {
        font-size: 0.9rem;
        color: var(--color-muted);
        margin: 0.25rem 0;
    }

    .resume-keywords {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: 0.5rem;
    }

    .resume-keyword-tag {
        font-size: 0.8rem;
        padding: 0.2rem 0.5rem;
        background: var(--color-surface);
        border: 1px solid var(--color-border);
        border-radius: 0.25rem;
    }

    .resume-link {
        color: var(--color-link);
        text-decoration: none;
        font-size: 0.9rem;
    }

    .resume-link:hover {
        text-decoration: underline;
    }

    @media (max-width: 768px) {
        .resume-modern {
            padding: 2rem 1rem;
        }

        .resume-name {
            font-size: 2rem;
        }

        .resume-skills-grid,
        .resume-education-grid,
        .resume-projects-grid,
        .resume-generic-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
