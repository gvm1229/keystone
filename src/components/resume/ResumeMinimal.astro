---
/**
 * Minimal 레이아웃: 매우 미니멀, 공간 활용 최적화
 */
import type { Resume } from "@/types/resume";

interface Props {
    resume: Resume;
}

const { resume } = Astro.props;
const basics = resume.basics ?? {};

// JSON 순서 유지: basics 제외한 섹션들을 순서대로
const sections = Object.entries(resume).filter(
    ([key]) => key !== "basics" && key !== "$schema"
);

// 날짜 범위 포맷팅 헬퍼 함수
const formatDateRange = (startDate?: string, endDate?: string): string => {
    return `${startDate || ""} ~ ${endDate || "Present"}`;
};
---

<div class="resume-minimal">
    <!-- 헤더: 기본 정보 -->
    <header class="resume-minimal-header">
        {basics.name ? <h1 class="resume-name">{basics.name}</h1> : null}
        {basics.label ? <div class="resume-label">{basics.label}</div> : null}
        <div class="resume-minimal-meta">
            {
                basics.email ? (
                    <span>
                        <a href={`mailto:${basics.email}`}>{basics.email}</a>
                    </span>
                ) : null
            }
            {basics.phone ? <span>{basics.phone}</span> : null}
            {
                basics.url ? (
                    <span>
                        <a
                            href={basics.url}
                            target="_blank"
                            rel="noopener noreferrer"
                        >
                            {basics.url}
                        </a>
                    </span>
                ) : null
            }
            {
                basics.location
                    ? [
                          basics.location.city,
                          basics.location.region,
                          basics.location.countryCode,
                      ]
                          .filter(Boolean)
                          .join(", ")
                    : null
            }
        </div>
        {
            basics.profiles && basics.profiles.length > 0 ? (
                <div class="resume-minimal-profiles">
                    {basics.profiles.map((profile, index) => (
                        <>
                            {index > 0 ? " • " : ""}
                            {profile.url ? (
                                <a
                                    href={profile.url}
                                    target="_blank"
                                    rel="noopener noreferrer"
                                >
                                    {profile.network}
                                </a>
                            ) : (
                                profile.network
                            )}
                        </>
                    ))}
                </div>
            ) : null
        }
    </header>

    <!-- 요약 섹션 -->
    {
        basics.summary ? (
            <section class="resume-summary-section">
                <p class="resume-summary">{basics.summary}</p>
            </section>
        ) : null
    }

    <!-- 메인 콘텐츠: 섹션별 렌더링 -->
    <main class="resume-minimal-main">
        {
            sections.map(([sectionKey, sectionValue]) => {
                // 빈 섹션은 렌더링하지 않음
                if (
                    !sectionValue ||
                    (Array.isArray(sectionValue) && sectionValue.length === 0)
                )
                    return null;

                // Skills 섹션: 컴팩트한 인라인 형식으로 표시
                if (sectionKey === "skills" && Array.isArray(sectionValue)) {
                    return (
                        <section class="resume-section">
                            <h2 class="resume-section-title">기술</h2>
                            <div class="resume-skills-compact">
                                {sectionValue.map((skill, skillIndex) => (
                                    <>
                                        {skill.name ? (
                                            <strong>{skill.name}</strong>
                                        ) : null}
                                        {skill.keywords &&
                                        skill.keywords.length > 0
                                            ? `: ${skill.keywords.join(", ")}`
                                            : ""}
                                        {skillIndex < sectionValue.length - 1
                                            ? " • "
                                            : ""}
                                    </>
                                ))}
                            </div>
                        </section>
                    );
                }

                // Work (경력) 섹션: 컴팩트한 리스트 형식으로 표시
                if (sectionKey === "work" && Array.isArray(sectionValue)) {
                    return (
                        <section class="resume-section">
                            <h2 class="resume-section-title">경력</h2>
                            {sectionValue.map((workItem) => (
                                <div class="resume-item-compact">
                                    <div class="resume-item-header-compact">
                                        {workItem.position ? (
                                            <span class="resume-item-title">
                                                {workItem.position}
                                            </span>
                                        ) : null}
                                        {workItem.name ? (
                                            <span class="resume-item-org">
                                                {workItem.url ? (
                                                    <a
                                                        href={workItem.url}
                                                        target="_blank"
                                                        rel="noopener noreferrer"
                                                    >
                                                        {workItem.name}
                                                    </a>
                                                ) : (
                                                    workItem.name
                                                )}
                                            </span>
                                        ) : null}
                                        {(workItem.startDate ||
                                            workItem.endDate) && (
                                            <span class="resume-item-date">
                                                {formatDateRange(
                                                    workItem.startDate,
                                                    workItem.endDate
                                                )}
                                            </span>
                                        )}
                                    </div>
                                    {workItem.summary ? (
                                        <p class="resume-item-summary">
                                            {workItem.summary}
                                        </p>
                                    ) : null}
                                    {workItem.highlights &&
                                    workItem.highlights.length > 0 ? (
                                        <ul class="resume-item-highlights">
                                            {workItem.highlights.map(
                                                (highlight: string) => (
                                                    <li>{highlight}</li>
                                                )
                                            )}
                                        </ul>
                                    ) : null}
                                </div>
                            ))}
                        </section>
                    );
                }

                // Education (학력) 섹션: 컴팩트한 리스트 형식으로 표시
                if (sectionKey === "education" && Array.isArray(sectionValue)) {
                    return (
                        <section class="resume-section">
                            <h2 class="resume-section-title">학력</h2>
                            {sectionValue.map((education) => (
                                <div class="resume-item-compact">
                                    <div class="resume-item-header-compact">
                                        {education.institution ? (
                                            <span class="resume-item-title">
                                                {education.url ? (
                                                    <a
                                                        href={education.url}
                                                        target="_blank"
                                                        rel="noopener noreferrer"
                                                    >
                                                        {education.institution}
                                                    </a>
                                                ) : (
                                                    education.institution
                                                )}
                                            </span>
                                        ) : null}
                                        {(education.studyType ||
                                            education.area) && (
                                            <span class="resume-item-org">
                                                {`${education.studyType || ""} ${education.area ? " " + education.area : ""}`}
                                            </span>
                                        )}
                                        {(education.startDate ||
                                            education.endDate) && (
                                            <span class="resume-item-date">
                                                {formatDateRange(
                                                    education.startDate,
                                                    education.endDate
                                                )}
                                            </span>
                                        )}
                                    </div>
                                    {education.score ? (
                                        <div class="resume-item-meta">
                                            GPA: {education.score}
                                        </div>
                                    ) : null}
                                    {education.courses &&
                                    education.courses.length > 0 ? (
                                        <div class="resume-item-meta">
                                            Courses:{" "}
                                            {education.courses.join(", ")}
                                        </div>
                                    ) : null}
                                </div>
                            ))}
                        </section>
                    );
                }

                // Projects (프로젝트) 섹션: 컴팩트한 리스트 형식으로 표시
                if (sectionKey === "projects" && Array.isArray(sectionValue)) {
                    return (
                        <section class="resume-section">
                            <h2 class="resume-section-title">프로젝트</h2>
                            {sectionValue.map((project) => (
                                <div class="resume-item-compact">
                                    <div class="resume-item-header-compact">
                                        {project.name ? (
                                            <span class="resume-item-title">
                                                {project.url ? (
                                                    <a
                                                        href={project.url}
                                                        target="_blank"
                                                        rel="noopener noreferrer"
                                                    >
                                                        {project.name}
                                                    </a>
                                                ) : (
                                                    project.name
                                                )}
                                            </span>
                                        ) : null}
                                        {(project.startDate ||
                                            project.endDate) && (
                                            <span class="resume-item-date">
                                                {formatDateRange(
                                                    project.startDate,
                                                    project.endDate
                                                )}
                                            </span>
                                        )}
                                    </div>
                                    {project.description ? (
                                        <p class="resume-item-summary">
                                            {project.description}
                                        </p>
                                    ) : null}
                                    {project.highlights &&
                                    project.highlights.length > 0 ? (
                                        <ul class="resume-item-highlights">
                                            {project.highlights.map(
                                                (highlight: string) => (
                                                    <li>{highlight}</li>
                                                )
                                            )}
                                        </ul>
                                    ) : null}
                                </div>
                            ))}
                        </section>
                    );
                }

                // 기타 섹션 (volunteer, awards, certificates, publications, languages, interests, references)
                if (Array.isArray(sectionValue) && sectionValue.length > 0) {
                    const sectionTitleMap: { [key: string]: string } = {
                        volunteer: "봉사 활동",
                        awards: "수상",
                        certificates: "자격증",
                        publications: "출판물",
                        languages: "언어",
                        interests: "관심사",
                        references: "추천인",
                    };
                    const sectionTitle =
                        sectionTitleMap[sectionKey] ||
                        sectionKey.charAt(0).toUpperCase() +
                            sectionKey.slice(1);

                    return (
                        <section class="resume-section">
                            <h2 class="resume-section-title">{sectionTitle}</h2>
                            {sectionValue.map((genericItem: any) => (
                                <div class="resume-item-compact">
                                    <div class="resume-item-header-compact">
                                        {genericItem.name ||
                                        genericItem.title ||
                                        genericItem.organization ||
                                        genericItem.language ? (
                                            <span class="resume-item-title">
                                                {genericItem.name ||
                                                    genericItem.title ||
                                                    genericItem.organization ||
                                                    genericItem.language}
                                            </span>
                                        ) : null}
                                        {genericItem.position ||
                                        genericItem.awarder ||
                                        genericItem.issuer ||
                                        genericItem.publisher ||
                                        genericItem.fluency ? (
                                            <span class="resume-item-org">
                                                {genericItem.position ||
                                                    genericItem.awarder ||
                                                    genericItem.issuer ||
                                                    genericItem.publisher ||
                                                    genericItem.fluency}
                                            </span>
                                        ) : null}
                                        {(genericItem.startDate ||
                                            genericItem.date ||
                                            genericItem.releaseDate) && (
                                            <span class="resume-item-date">
                                                {genericItem.startDate ||
                                                    genericItem.date ||
                                                    genericItem.releaseDate}
                                                {genericItem.endDate
                                                    ? " ~ " +
                                                      genericItem.endDate
                                                    : ""}
                                            </span>
                                        )}
                                    </div>
                                    {genericItem.summary ||
                                    genericItem.description ? (
                                        <p class="resume-item-summary">
                                            {genericItem.summary ||
                                                genericItem.description}
                                        </p>
                                    ) : null}
                                    {genericItem.highlights &&
                                    Array.isArray(genericItem.highlights) &&
                                    genericItem.highlights.length > 0 ? (
                                        <ul class="resume-item-highlights">
                                            {genericItem.highlights.map(
                                                (highlight: string) => (
                                                    <li>{highlight}</li>
                                                )
                                            )}
                                        </ul>
                                    ) : null}
                                    {genericItem.keywords &&
                                    Array.isArray(genericItem.keywords) &&
                                    genericItem.keywords.length > 0 ? (
                                        <div class="resume-item-meta">
                                            {genericItem.keywords.join(", ")}
                                        </div>
                                    ) : null}
                                    {genericItem.url ? (
                                        <div class="resume-item-meta">
                                            <a
                                                href={genericItem.url}
                                                target="_blank"
                                                rel="noopener noreferrer"
                                            >
                                                {genericItem.url}
                                            </a>
                                        </div>
                                    ) : null}
                                    {genericItem.reference ? (
                                        <p class="resume-item-summary">
                                            {genericItem.reference}
                                        </p>
                                    ) : null}
                                </div>
                            ))}
                        </section>
                    );
                }

                return null;
            })
        }
    </main>
</div>

<style>
    .resume-minimal {
        max-width: 800px;
        margin: 0 auto;
        padding: 2rem 1.5rem;
        font-family:
            system-ui,
            -apple-system,
            sans-serif;
        color: var(--color-foreground);
        background: var(--color-surface);
        line-height: 1.6;
    }

    .resume-minimal-header {
        margin-bottom: 2rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid var(--color-border);
    }

    .resume-name {
        font-size: 1.75rem;
        font-weight: 600;
        margin: 0 0 0.25rem 0;
        color: var(--color-foreground);
        letter-spacing: -0.02em;
    }

    .resume-label {
        font-size: 0.95rem;
        color: var(--color-muted);
        margin-bottom: 0.75rem;
    }

    .resume-minimal-meta {
        font-size: 0.85rem;
        color: var(--color-muted);
        margin-bottom: 0.5rem;
    }

    .resume-minimal-meta span {
        margin-right: 1rem;
    }

    .resume-minimal-meta a {
        color: var(--color-link);
        text-decoration: none;
    }

    .resume-minimal-meta a:hover {
        text-decoration: underline;
    }

    .resume-minimal-profiles {
        font-size: 0.85rem;
        color: var(--color-muted);
    }

    .resume-minimal-profiles a {
        color: var(--color-link);
        text-decoration: none;
    }

    .resume-minimal-profiles a:hover {
        text-decoration: underline;
    }

    .resume-summary-section {
        margin-bottom: 2rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid var(--color-border);
    }

    .resume-summary {
        font-size: 0.95rem;
        line-height: 1.7;
        margin: 0;
        color: var(--color-foreground);
    }

    .resume-minimal-main {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
    }

    .resume-section {
        margin-bottom: 1.5rem;
    }

    .resume-section-title {
        font-size: 0.85rem;
        font-weight: 600;
        margin: 0 0 0.75rem 0;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid var(--color-border);
        color: var(--color-foreground);
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .resume-skills-compact {
        font-size: 0.9rem;
        line-height: 1.8;
    }

    .resume-skills-compact strong {
        font-weight: 600;
    }

    .resume-item-compact {
        margin-bottom: 1rem;
    }

    .resume-item-header-compact {
        display: flex;
        flex-wrap: wrap;
        align-items: baseline;
        gap: 0.5rem;
        margin-bottom: 0.25rem;
    }

    .resume-item-title {
        font-weight: 600;
        font-size: 0.95rem;
    }

    .resume-item-title a {
        color: var(--color-link);
        text-decoration: none;
    }

    .resume-item-title a:hover {
        text-decoration: underline;
    }

    .resume-item-org {
        font-size: 0.9rem;
        color: var(--color-muted);
    }

    .resume-item-date {
        font-size: 0.85rem;
        color: var(--color-muted);
        margin-left: auto;
    }

    .resume-item-summary {
        font-size: 0.9rem;
        line-height: 1.6;
        margin: 0.25rem 0;
        color: var(--color-foreground);
    }

    .resume-item-highlights {
        margin: 0.25rem 0;
        padding-left: 1.25rem;
        font-size: 0.9rem;
    }

    .resume-item-highlights li {
        margin-bottom: 0.15rem;
    }

    .resume-item-meta {
        font-size: 0.85rem;
        color: var(--color-muted);
        margin-top: 0.25rem;
    }

    .resume-item-meta a {
        color: var(--color-link);
        text-decoration: none;
    }

    .resume-item-meta a:hover {
        text-decoration: underline;
    }

    @media (max-width: 768px) {
        .resume-minimal {
            padding: 1.5rem 1rem;
        }

        .resume-item-header-compact {
            flex-direction: column;
            align-items: flex-start;
        }

        .resume-item-date {
            margin-left: 0;
        }
    }

    @media print {
        .resume-minimal {
            padding: 0;
        }

        .resume-section {
            page-break-inside: avoid;
        }
    }
</style>
