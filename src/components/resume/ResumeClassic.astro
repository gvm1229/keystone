---
/**
 * Classic 레이아웃: 왼쪽 사이드바(기본 정보) + 오른쪽 메인(경력 등)
 */
import type { Resume } from "@/types/resume";

interface Props {
    resume: Resume;
}

const { resume } = Astro.props;
const basics = resume.basics ?? {};

// JSON 순서 유지: basics 제외한 섹션들을 순서대로
const sections = Object.entries(resume).filter(
    ([key]) => key !== "basics" && key !== "$schema"
);

// 날짜 범위 포맷팅 헬퍼 함수
const formatDateRange = (startDate?: string, endDate?: string): string => {
    return `${startDate || ""} ~ ${endDate || "Present"}`;
};
---

<div class="resume-classic">
    <!-- 왼쪽 사이드바: 기본 정보 -->
    <div class="resume-classic-sidebar">
        {basics.name ? <h1 class="resume-name">{basics.name}</h1> : null}
        {basics.label ? <p class="resume-label">{basics.label}</p> : null}
        {basics.summary ? <p class="resume-summary">{basics.summary}</p> : null}

        <!-- 연락처 정보 -->
        {
            basics.email || basics.phone || basics.url ? (
                <div class="resume-contact">
                    {basics.email ? (
                        <div>
                            <strong>Email</strong>
                            <a href={`mailto:${basics.email}`}>
                                {basics.email}
                            </a>
                        </div>
                    ) : null}
                    {basics.phone ? (
                        <div>
                            <strong>Phone</strong>
                            <span>{basics.phone}</span>
                        </div>
                    ) : null}
                    {basics.url ? (
                        <div>
                            <strong>Website</strong>
                            <a
                                href={basics.url}
                                target="_blank"
                                rel="noopener noreferrer"
                            >
                                {basics.url}
                            </a>
                        </div>
                    ) : null}
                </div>
            ) : null
        }

        <!-- 위치 정보 -->
        {
            basics.location ? (
                <div class="resume-location">
                    <strong>Location</strong>
                    <div>
                        {[
                            basics.location.address,
                            basics.location.city,
                            basics.location.region,
                            basics.location.postalCode,
                            basics.location.countryCode,
                        ]
                            .filter(Boolean)
                            .join(", ")}
                    </div>
                </div>
            ) : null
        }

        <!-- 프로필 링크 -->
        {
            basics.profiles && basics.profiles.length > 0 ? (
                <div class="resume-profiles">
                    <strong>Profiles</strong>
                    {basics.profiles.map((profile) => (
                        <div>
                            {profile.network}:{" "}
                            {profile.url ? (
                                <a
                                    href={profile.url}
                                    target="_blank"
                                    rel="noopener noreferrer"
                                >
                                    {profile.username || profile.url}
                                </a>
                            ) : (
                                profile.username
                            )}
                        </div>
                    ))}
                </div>
            ) : null
        }
    </div>

    <!-- 오른쪽 메인: 경력, 학력 등 -->
    <div class="resume-classic-main">
        {
            sections.map(([sectionKey, sectionValue]) => {
                // 빈 섹션은 렌더링하지 않음
                if (
                    !sectionValue ||
                    (Array.isArray(sectionValue) && sectionValue.length === 0)
                )
                    return null;

                // Skills 섹션 렌더링
                if (sectionKey === "skills" && Array.isArray(sectionValue)) {
                    return (
                        <section class="resume-section">
                            <h2 class="resume-section-title">Skills</h2>
                            <div class="resume-skills">
                                {sectionValue.map((skill) => (
                                    <div class="resume-skill-item">
                                        {skill.name ? (
                                            <strong>{skill.name}</strong>
                                        ) : null}
                                        {skill.level ? (
                                            <span class="resume-skill-level">
                                                {skill.level}
                                            </span>
                                        ) : null}
                                        {skill.keywords &&
                                        skill.keywords.length > 0 ? (
                                            <div class="resume-skill-keywords">
                                                {skill.keywords.join(", ")}
                                            </div>
                                        ) : null}
                                    </div>
                                ))}
                            </div>
                        </section>
                    );
                }

                // Work (경력) 섹션 렌더링
                if (sectionKey === "work" && Array.isArray(sectionValue)) {
                    return (
                        <section class="resume-section">
                            <h2 class="resume-section-title">Experience</h2>
                            {sectionValue.map((workItem) => (
                                <div class="resume-work-item">
                                    <div class="resume-work-header">
                                        {workItem.name ? (
                                            <h3 class="resume-work-company">
                                                {workItem.url ? (
                                                    <a
                                                        href={workItem.url}
                                                        target="_blank"
                                                        rel="noopener noreferrer"
                                                    >
                                                        {workItem.name}
                                                    </a>
                                                ) : (
                                                    workItem.name
                                                )}
                                            </h3>
                                        ) : null}
                                        {workItem.position ? (
                                            <div class="resume-work-position">
                                                {workItem.position}
                                            </div>
                                        ) : null}
                                        {(workItem.startDate ||
                                            workItem.endDate) && (
                                            <div class="resume-work-dates">
                                                {formatDateRange(
                                                    workItem.startDate,
                                                    workItem.endDate
                                                )}
                                            </div>
                                        )}
                                    </div>
                                    {workItem.summary ? (
                                        <p class="resume-work-summary">
                                            {workItem.summary}
                                        </p>
                                    ) : null}
                                    {workItem.highlights &&
                                    workItem.highlights.length > 0 ? (
                                        <ul class="resume-work-highlights">
                                            {workItem.highlights.map(
                                                (highlight: string) => (
                                                    <li>{highlight}</li>
                                                )
                                            )}
                                        </ul>
                                    ) : null}
                                </div>
                            ))}
                        </section>
                    );
                }

                // Education (학력) 섹션 렌더링
                if (sectionKey === "education" && Array.isArray(sectionValue)) {
                    return (
                        <section class="resume-section">
                            <h2 class="resume-section-title">Education</h2>
                            {sectionValue.map((education) => (
                                <div class="resume-education-item">
                                    {education.institution ? (
                                        <h3 class="resume-education-institution">
                                            {education.url ? (
                                                <a
                                                    href={education.url}
                                                    target="_blank"
                                                    rel="noopener noreferrer"
                                                >
                                                    {education.institution}
                                                </a>
                                            ) : (
                                                education.institution
                                            )}
                                        </h3>
                                    ) : null}
                                    {(education.studyType ||
                                        education.area) && (
                                        <div class="resume-education-degree">
                                            {`${education.studyType || ""} ${education.area ? " " + education.area : ""}`}
                                        </div>
                                    )}
                                    {(education.startDate ||
                                        education.endDate) && (
                                        <div class="resume-education-dates">
                                            {formatDateRange(
                                                education.startDate,
                                                education.endDate
                                            )}
                                        </div>
                                    )}
                                    {education.score && (
                                        <div class="resume-education-score">
                                            GPA: {education.score}
                                        </div>
                                    )}
                                    {education.courses &&
                                    education.courses.length > 0 ? (
                                        <div class="resume-education-courses">
                                            Courses:{" "}
                                            {education.courses.join(", ")}
                                        </div>
                                    ) : null}
                                </div>
                            ))}
                        </section>
                    );
                }

                // Projects (프로젝트) 섹션 렌더링
                if (sectionKey === "projects" && Array.isArray(sectionValue)) {
                    return (
                        <section class="resume-section">
                            <h2 class="resume-section-title">Projects</h2>
                            {sectionValue.map((project) => (
                                <div class="resume-project-item">
                                    {project.name ? (
                                        <h3 class="resume-project-name">
                                            {project.url ? (
                                                <a
                                                    href={project.url}
                                                    target="_blank"
                                                    rel="noopener noreferrer"
                                                >
                                                    {project.name}
                                                </a>
                                            ) : (
                                                project.name
                                            )}
                                        </h3>
                                    ) : null}
                                    {(project.startDate || project.endDate) && (
                                        <div class="resume-project-dates">
                                            {formatDateRange(
                                                project.startDate,
                                                project.endDate
                                            )}
                                        </div>
                                    )}
                                    {project.description ? (
                                        <p class="resume-project-description">
                                            {project.description}
                                        </p>
                                    ) : null}
                                    {project.highlights &&
                                    project.highlights.length > 0 ? (
                                        <ul class="resume-project-highlights">
                                            {project.highlights.map(
                                                (highlight: string) => (
                                                    <li>{highlight}</li>
                                                )
                                            )}
                                        </ul>
                                    ) : null}
                                </div>
                            ))}
                        </section>
                    );
                }

                // 기타 섹션 (volunteer, awards, certificates, publications, languages, interests, references)
                if (Array.isArray(sectionValue) && sectionValue.length > 0) {
                    const sectionTitleMap: { [key: string]: string } = {
                        volunteer: "Volunteer",
                        awards: "Awards",
                        certificates: "Certificates",
                        publications: "Publications",
                        languages: "Languages",
                        interests: "Interests",
                        references: "References",
                    };
                    const sectionTitle =
                        sectionTitleMap[sectionKey] ||
                        sectionKey.charAt(0).toUpperCase() +
                            sectionKey.slice(1);

                    return (
                        <section class="resume-section">
                            <h2 class="resume-section-title">{sectionTitle}</h2>
                            {sectionValue.map((genericItem: any) => (
                                <div class="resume-generic-item">
                                    {genericItem.name ||
                                    genericItem.title ||
                                    genericItem.organization ||
                                    genericItem.language ? (
                                        <h3>
                                            {genericItem.name ||
                                                genericItem.title ||
                                                genericItem.organization ||
                                                genericItem.language}
                                        </h3>
                                    ) : null}
                                    {genericItem.position ||
                                    genericItem.awarder ||
                                    genericItem.issuer ||
                                    genericItem.publisher ||
                                    genericItem.fluency ? (
                                        <div class="resume-generic-meta">
                                            {genericItem.position ||
                                                genericItem.awarder ||
                                                genericItem.issuer ||
                                                genericItem.publisher ||
                                                genericItem.fluency}
                                        </div>
                                    ) : null}
                                    {genericItem.startDate ||
                                    genericItem.date ||
                                    genericItem.releaseDate ? (
                                        <div class="resume-generic-date">
                                            {`${genericItem.startDate || genericItem.date || genericItem.releaseDate || ""}${
                                                genericItem.endDate
                                                    ? " ~ " +
                                                      genericItem.endDate
                                                    : ""
                                            }`}
                                        </div>
                                    ) : null}
                                    {genericItem.summary ||
                                    genericItem.description ? (
                                        <p>
                                            {genericItem.summary ||
                                                genericItem.description}
                                        </p>
                                    ) : null}
                                    {genericItem.highlights &&
                                    Array.isArray(genericItem.highlights) &&
                                    genericItem.highlights.length > 0 ? (
                                        <ul>
                                            {genericItem.highlights.map(
                                                (highlight: string) => (
                                                    <li>{highlight}</li>
                                                )
                                            )}
                                        </ul>
                                    ) : null}
                                    {genericItem.keywords &&
                                    Array.isArray(genericItem.keywords) &&
                                    genericItem.keywords.length > 0 ? (
                                        <div>
                                            {genericItem.keywords.join(", ")}
                                        </div>
                                    ) : null}
                                    {genericItem.url ? (
                                        <a
                                            href={genericItem.url}
                                            target="_blank"
                                            rel="noopener noreferrer"
                                        >
                                            {genericItem.url}
                                        </a>
                                    ) : null}
                                    {genericItem.reference ? (
                                        <p>{genericItem.reference}</p>
                                    ) : null}
                                </div>
                            ))}
                        </section>
                    );
                }

                return null;
            })
        }
    </div>
</div>

<style>
    .resume-classic {
        display: grid;
        grid-template-columns: 280px 1fr;
        gap: 2rem;
        max-width: 1000px;
        margin: 0 auto;
        padding: 2rem;
        font-family:
            system-ui,
            -apple-system,
            sans-serif;
        color: var(--color-foreground);
        background: var(--color-surface);
    }

    .resume-classic-sidebar {
        border-right: 2px solid var(--color-border);
        padding-right: 2rem;
    }

    .resume-name {
        font-size: 1.75rem;
        font-weight: 700;
        margin: 0 0 0.5rem 0;
        color: var(--color-foreground);
    }

    .resume-label {
        font-size: 1rem;
        color: var(--color-muted);
        margin: 0 0 1rem 0;
    }

    .resume-summary {
        font-size: 0.9rem;
        line-height: 1.6;
        margin: 0 0 1.5rem 0;
        color: var(--color-foreground);
    }

    .resume-contact,
    .resume-location,
    .resume-profiles {
        margin-bottom: 1.5rem;
        font-size: 0.875rem;
    }

    .resume-contact strong,
    .resume-location strong,
    .resume-profiles strong {
        display: block;
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--color-muted);
        margin-bottom: 0.5rem;
    }

    .resume-contact a,
    .resume-profiles a {
        color: var(--color-link);
        text-decoration: none;
    }

    .resume-contact a:hover,
    .resume-profiles a:hover {
        text-decoration: underline;
    }

    .resume-classic-main {
        padding-left: 1rem;
    }

    .resume-section {
        margin-bottom: 2rem;
    }

    .resume-section-title {
        font-size: 1.25rem;
        font-weight: 600;
        margin: 0 0 1rem 0;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid var(--color-border);
        color: var(--color-foreground);
    }

    .resume-work-item,
    .resume-education-item,
    .resume-project-item,
    .resume-generic-item {
        margin-bottom: 1.5rem;
    }

    .resume-work-header {
        margin-bottom: 0.5rem;
    }

    .resume-work-company,
    .resume-education-institution,
    .resume-project-name {
        font-size: 1.1rem;
        font-weight: 600;
        margin: 0 0 0.25rem 0;
    }

    .resume-work-company a,
    .resume-education-institution a,
    .resume-project-name a {
        color: var(--color-link);
        text-decoration: none;
    }

    .resume-work-position,
    .resume-education-degree {
        font-size: 0.95rem;
        color: var(--color-muted);
        margin-bottom: 0.25rem;
    }

    .resume-work-dates,
    .resume-education-dates,
    .resume-project-dates,
    .resume-generic-date {
        font-size: 0.875rem;
        color: var(--color-muted);
        margin-bottom: 0.5rem;
    }

    .resume-work-summary,
    .resume-project-description {
        font-size: 0.9rem;
        line-height: 1.6;
        margin: 0.5rem 0;
    }

    .resume-work-highlights,
    .resume-project-highlights {
        margin: 0.5rem 0;
        padding-left: 1.25rem;
        font-size: 0.9rem;
    }

    .resume-work-highlights li,
    .resume-project-highlights li {
        margin-bottom: 0.25rem;
    }

    .resume-skills {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }

    .resume-skill-item {
        font-size: 0.9rem;
    }

    .resume-skill-level {
        display: inline-block;
        margin-left: 0.5rem;
        font-size: 0.85rem;
        color: var(--color-muted);
    }

    .resume-skill-keywords {
        margin-top: 0.25rem;
        font-size: 0.85rem;
        color: var(--color-muted);
    }

    .resume-education-score,
    .resume-education-courses {
        font-size: 0.875rem;
        color: var(--color-muted);
        margin-top: 0.25rem;
    }

    .resume-generic-meta {
        font-size: 0.9rem;
        color: var(--color-muted);
        margin: 0.25rem 0;
    }

    @media (max-width: 768px) {
        .resume-classic {
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }

        .resume-classic-sidebar {
            border-right: none;
            border-bottom: 2px solid var(--color-border);
            padding-right: 0;
            padding-bottom: 1.5rem;
        }

        .resume-classic-main {
            padding-left: 0;
        }
    }
</style>
